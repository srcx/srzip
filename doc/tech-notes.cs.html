<!--  tech-notes.cs.aft (c)2000 Stepan Roh - iso-8859-2 encoding -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>srzip 0.3 - Poznámky k implementaci</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2"/>
	<meta name="author" content="©tìpán Roh">
	<meta name="GENERATOR" content = "Almost Free Text v5.095; Copyright 1996-2004 Todd Coram. All rights reserved.">
</head>
<body>

<br><center><h1><a name="AFT-top">srzip 0.3 - Poznámky k implementaci</a></h1></center>
<br><center><h2>©tìpán Roh</h2></center>
<center>Verze 0.3</center>
<center>Revize dokumentu 1.1 (15.1.2005)</center>
<!-- Start SectLevel1 -->
<h2><a name="Metoda bwt">Metoda bwt</a></h2>
<p class="Body">
Ve¹kerý kód k metodì bwt je obsa¾en v souborech m_bwt.[hc] (navíc je
vyu¾íván kód metody ahc ze souborù m_ahc.[hc]). Pro obecné seznámení s
principy bwt doporuèuji [<a class="link" href="#1">1</a>].
</p>
<!-- Start SectLevel2 -->
<h3><a name="Jednotlivá stádia komprese">Jednotlivá stádia komprese</a></h3>
<p class="Body">
Ve¹kerá komprese se provádí po blocích jejich¾ velikost je pøímo úmìrná
kvalitì komprese. Burrows-Wheelerova transformace (viz [<a class="link" href="#2">2</a>]) je
implementována fcí do_bwt(in_buf, out_buf, len, idx_buf), která provede
transformaci vstupního bufferu in_buf (o délce len) na výstupní buffer
out_buf. Oproti nejzákladnìj¹í implementaci transformace jsou tyto
vylep¹ení : kruhový buffer není nový buffer, ale pole ukazatelù do vstupního
bufferu (idx_buf), k urychlení tøídìní (které se provádí pomocí
standardního qsort()) se na konec vstupního bufferu pøimyslí tzv. eof znak,
který má vìt¹í hodnotu ne¾ kterýkoliv jiný znak, tím pádem není tøeba
porovnávat kruhové øetìzce, ale pouze suffixy vstupu. Jen je tøeba
zachovávat tento eof znak v prùbìhu celé komprese i dekomprese. Tímto bylo
dosa¾eno pøibli¾nì dvojnásobného zrychlení. Toto vylep¹ení se zakládá na
my¹lence z èlánku Marka Nelsona (viz [<a class="link" href="#3">3</a>]). I pøes toto vylep¹ení
je komprese velice pomalá a to kvùli quicksortu. Ten dosahuje nejhor¹ích
výsledkù na datech s vysokým podílem opakujících se úsekù (je nutno
porovnávat dlouhé bloky). Bohu¾el toto je pøesnì to, co zpùsobuje úspì¹nost
této transformace a vyskytuje se v bì¾ných datech pomìrnì èasto. Proto byla
vyzkou¹ena i odli¹ná metoda tøídìní a to suffixový strom. Bohu¾el se
ukázalo, ¾e èasový zisk není tak vysoký, aby pøevý¹il pamì»ovou nároènost
(a¾ 40-krát vy¹¹í ne¾ u quicksortu). Zde je srovnání slo¾itostí :
</p>
<!-- 3 columns --><table border>
<caption>&nbsp;&nbsp;Srovnání slo¾itostí&nbsp;&nbsp;&nbsp;&nbsp;</caption>
<tr><th>&nbsp;&nbsp;&nbsp;&nbsp;</th><th> qsort&nbsp;&nbsp;&nbsp;&nbsp;</th><th> stree&nbsp;&nbsp;</th></tr>
<tr><td> èasová  &nbsp;&nbsp;</td><td> O(N*log(N))&nbsp;&nbsp;</td><td> O(N)&nbsp;&nbsp;</td></tr>
<tr><td> pamì»ová&nbsp;&nbsp;</td><td> O(N)&nbsp;&nbsp;&nbsp;&nbsp;</td><td> O(N)&nbsp;&nbsp;</td></tr>
</table>
<p class="Body">
To nevypadá tak zle, ale v absolutních èíslech je vidìt nìco jiného :
stree spotøebuje pøibli¾nì 20 bytù na uzel (v mé implementaci, normálnì je
to 16 bytù, ale s dodateènými nároky pøi procházení stromu) pøi maximálním
poètu 2*N uzlù. Implementace se suffixovým stromem je v adresáøi
bwt_as_stree, ale pozor, na nìkterých datech tøídí ¹patnì a tedy i generuje
¹patné výstupy.
</p>
<p class="Body">
Dále navazuje Move-to-front kódování implementované fcí do_mtf(buffer, len),
které se nijak neli¹í od bì¾ných implementací.
</p>
<p class="Body">
Následnì se výstup kóduje pomocí ahc (adaptivního huffmanova kódování),
pøièem¾ se nejdøíve provede zakódování øetìzcù nul do dvojice (0, délka-1),
to je víceménì postup navrhovaný v [<a class="link" href="#1">1</a>]. Øetìzce nul jsou ve výstupu z mtf
velice èasté, tak¾e se tím dosáhne výrazného zlep¹ení kompresního pomìru,
pøibli¾nì o ètvrtinu.
</p>
<!--End Section 2-->
<h3><a name="Jednotlivá stádia dekomprese">Jednotlivá stádia dekomprese</a></h3>
<p class="Body">
Komprimovaná data se nejprve pro¾enou dekompresí pomocí ahc, v prùbìhu
dekomprese se plynule dekódují zakódované øetézce nul.
</p>
<p class="Body">
Poté následuje zpìtné mtf (fce rev_mtf(buffer, len)), na nìm¾ není nic
zajímavého.
</p>
<p class="Body">
Zpìtná Burrows-Wheelerova transformace je implementována funkcí
rev_bwt(in_buf, op, out_buf, buf_len, tbuf), která transformuje in_buf do
out_buf, op je pozice pùvodních dat v setøídìném bufferu a tedy i pozice
jediného výskytu eof znaku v bufferu. Transformuje se pomocí konstrukce
transformaèního vektoru v tbuf.
</p>
<!--End Section 2-->
<h3><a name="Rychlost a úspì¹nost metody">Rychlost a úspì¹nost metody</a></h3>
<p class="Body">
Komprese je velice pomalá : oproti programu gzip (který pou¾ívá slovníkovou
kompresi) nebo programu bzip2 (který pou¾ívá bwt) mù¾e být a¾ 50-krát
pomalej¹í - zde se projevuje pomalé tøídìní pomocí qsort(), bzip2 pou¾ívá
také qsort, ale modifikovaný (s vy¹¹í pamì»ovou nároèností). Kompresní pomìr
je vy¹¹í ne¾ u programu gzip a je porovnatelný s programem bzip2 (hor¹í v
øádech desetin procenta). Dekomprese je velice rychlá, srovnatelná s
ostatními programy.
</p>
<ul>
<li> [<a name="1">1</a>] Roh, ©tìpán : &quot;Burrows-Wheelerova transformace&quot;<br>  <a class="link" href="http://www.srnet.cz/~stepan/st/bwt.html">http://www.srnet.cz/~stepan/st/bwt.html</a></li>
<li> [<a name="2">2</a>] Burrows, M. and Wheeler, D.J. (1994) : &quot;A Block-sorting Lossless Data Compression Algorithm&quot;<br>  Digital Systems Research Center Research Report 124<br>  <a class="link" href="http://gatekeeper.dec.com/pub/DEC/SRC/research-reports/abstracts/src-rr-124.html">http://gatekeeper.dec.com/pub/DEC/SRC/research-reports/abstracts/src-rr-124.html</a></li>
<li> [<a name="3">3</a>] Nelson, Mark : &quot;Data Compression with the Burrows-Wheeler Transform&quot;<br>  Dr.Dobbs Journal, September 1996<br>  <a class="link" href="http://www.dogma.net/markn/articles/bwt/bwt.htm">http://www.dogma.net/markn/articles/bwt/bwt.htm</a></li>
</ul>
<!--End Section 2-->
<!-- End SectLevel2 -->
<!--End Section 1-->
<!-- End SectLevel1 -->
<hr>
<br>
<p align="right"> <small>This document was generated using <a class="link" href="http://www.maplefish.com/todd/aft.html">AFT v5.095</a></small> </p>
</body>
</html>

